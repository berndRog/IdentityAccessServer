@page "/"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inject BankingBlazorSSR.Hosting.Clients.OwnersClient Owners

<PageTitle>Home</PageTitle>

<h3>Owner</h3>

@if (_loading)
{
  <p>Lade …</p>
}
else if (_error is not null)
{
  <div class="alert alert-danger">@_error</div>
}
else
{
  <p><b>OwnerId:</b> @_ownerId</p>

  <hr />
  <p><b>Name:</b> @_profile!.Firstname @_profile!.Lastname</p>
  <p><b>Email:</b> @_profile!.Email</p>
}

@code {
  private bool _loading = true;
  private string? _error;

  private Guid _ownerId;
  private BankingBlazorSSR.Hosting.Dtos.OwnerProfileDto? _profile;

  protected override async Task OnInitializedAsync()
  {
    try
    {
      _ownerId = await Owners.ProvisionMeAsync();     // POST, returns Guid
      _profile = await Owners.GetMeProfileAsync();    // GET, returns OwnerProfileDto
    }
    catch (Exception ex)
    {
      _error = ex.Message;
    }
    finally
    {
      _loading = false;
    }
  }
}